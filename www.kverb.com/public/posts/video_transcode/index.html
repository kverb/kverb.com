<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>video transcoding &middot; Kverb.com</title>
    <meta name="title" content="video transcoding &middot; Kverb.com" />
  
  <meta name="description" content="Ken Verb&#39;s random stuff on the inwtwernet" />
  
  
  
  <link rel="canonical" href="/posts/video_transcode/" />
  
  
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.cc1150d752794c8e13af5310929ffc4138306967da7ca1cf6850784f2b0f30ecf9cef003facca14f7a4862885f049e2b4e4abd3a2f387c89bc56036e5705d700.css"
    integrity="sha512-zBFQ11J5TI4Tr1MQkp/8QTgwaWfafKHPaFB4TysPMOz5zvAD&#43;syhT3pIYohfBJ4rTkq9Oi84fIm8VgNuVwXXAA=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js" integrity="sha512-EumHQs0oNXTQMKf&#43;VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.9ae0a991bb442898e9bc60cf318b4de3ff878325ff3821625a5564b32b2f66aec0e7f7d0e00ca3ac7df59d9f01c18c88b6bdd213184f86ac9ce06d7bdffbadf8.js" integrity="sha512-muCpkbtEKJjpvGDPMYtN4/&#43;HgyX/OCFiWlVksysvZq7A5/fQ4AyjrH31nZ8BwYyItr3SExhPhqyc4G173/ut&#43;A==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="video transcoding" />
<meta property="og:description" content="meta # These are some notes gathered on my exploration of transcoding videos for more reliable playback." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/video_transcode/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-11T12:45:58-04:00" />
<meta property="article:modified_time" content="2022-06-11T12:45:58-04:00" /><meta property="og:site_name" content="Kverb.com" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="video transcoding"/>
<meta name="twitter:description" content="meta # These are some notes gathered on my exploration of transcoding videos for more reliable playback."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "video transcoding",
    "headline": "video transcoding",
    
    "abstract": "meta # These are some notes gathered on my exploration of transcoding videos for more reliable playback.",
    "inLanguage": "en",
    "url" : "\/posts\/video_transcode\/",
    "author" : {
      "@type": "Person",
      "name": "Ken Verb"
    },
    "copyrightYear": "2022",
    "dateCreated": "2022-06-11T12:45:58-04:00",
    "datePublished": "2022-06-11T12:45:58-04:00",
    
    "dateModified": "2022-06-11T12:45:58-04:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "975"
  }]
  </script>


  
  <meta name="author" content="Ken Verb" />
  
    
      <link href="mailto:www@kverb.com" rel="me" />
    
      <link href="https://github.com/kverb" rel="me" />
    
      <link href="https://instagram.com/kverb.com" rel="me" />
    
      <link href="https://keybase.io/kverb" rel="me" />
    
  
  
  






  
  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div><header
  class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"
>
  
  <div>
    
      <a
        class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
        rel="me"
        href="/"
        >Kverb.com</a
      >
    

  </div>
  
  
    <nav>
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/posts/"
              title="Posts"
              >posts</a
            >
          </li>
        
        
      </ul>
    </nav>
  
</header>
<div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        video transcoding
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2022-06-11 12:45:58 -0400 EDT">11 June 2022</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">5 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#meta">meta</a></li>
    <li><a href="#overview">overview</a></li>
    <li><a href="#donmeltons-other_video_transcode-tool">Donmelton&rsquo;s other_video_transcode tool</a></li>
    <li><a href="#further-reading">further reading</a></li>
    <li><a href="#still-todo--open-questions">still TODO / open questions</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <h2 id="meta" class="relative group">meta <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#meta" aria-label="Anchor">#</a></span></h2>
<p>These are some notes gathered on my exploration of transcoding videos for more reliable playback.
This doesn’t cover the downloading of the video files; just post-processing them into different formats for playback, primarily on an Apple TV 4k (2019).</p>
<p>Hardware used:</p>
<ul>
<li>AMD Ryzen 7 3800X 8-Core Processor + NVIDIA GeForce RTX 2060 SUPER</li>
<li>11th Gen Intel(R) Core(TM) i5-11400 @ 2.60GHz + (iGPU)</li>
</ul>
<h2 id="overview" class="relative group">overview <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#overview" aria-label="Anchor">#</a></span></h2>
<p>The main take-aways are:</p>
<ul>
<li>Most titles downloaded from the internet are h264 encoded, mkv container files.</li>
<li>Audio codecs vary and subtitles are complete anarchy.</li>
<li>AppleTV (my primary playback client) can play the h264 encoded stream generally without issue.
<ul>
<li>It requires on-the-fly remux from MKV to MP4 and (usually) audio transcoding, but generally uses very little cpu on the plex server.</li>
</ul>
</li>
<li>HEVC / h265 <em>can</em> be more space efficient for the same quality, so converting the library to it is worthwhile.
<ul>
<li>However, there are observable limits to how much space can be saved for a given quality level.</li>
<li>The main heuristic is thus:
<ul>
<li>if the source file is a high-bitrate, h264 or original iso, then convert to HEVC at about 10mbps (for 1080p).</li>
<li>In general, the quality trade off (as well as the energy required to process the transcode) just doesn’t make sense if the file is already below an avg bitrate of 15 mbps.</li>
<li>Also, a “how much do i like this movie” factor should be considered for if and how much quality loss is acceptable.</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://codecalamity.com/hardware-encoding-4k-hdr10-videos/#has-hevc-hardware-encoding-caught-up-to-the-quality-of-software-encoding">Prefer libx265 (cpu / software) based transcodes to GPU-assisted transcodes.</a> GPU is ideal for real-time transcoding.</li>
<li>Although it will take much longer, x265 will yield higher quality at smaller space.</li>
<li>Consider GPU transcodes for “less important” titles; i.e., movies and series that don’t need “archival quality”.</li>
<li>Subtitles are &hellip; annoying if converting from mkv to mp4.
<ul>
<li>The <a href="https://github.com/donmelton/other_video_transcoding">“other transcoding”</a> script seems to handle this, but because mp4 lacks support for lots of subtitle formats, there are still limitations.</li>
</ul>
</li>
</ul>
<h2 id="donmeltons-other_video_transcode-tool" class="relative group">Donmelton&rsquo;s other_video_transcode tool <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#donmeltons-other_video_transcode-tool" aria-label="Anchor">#</a></span></h2>
<p>Use this script to generate an ffmpeg command that can be executed on another system, if needed.</p>
<p><a href="https://github.com/donmelton/other_video_transcoding">https://github.com/donmelton/other_video_transcoding</a></p>
<p>This is basically an easier-to-understand wrapper for ffmpeg.
Install ruby, then install this with ruby gems.
It&rsquo;s helpful to read the script to get a better understanding of all the options and how they map to ffmpeg params.</p>
<p>It requires <strong>ffmpeg</strong> and the <a href="%5Bhttps://archlinux.org/packages/extra/x86_64/mkvtoolnix-cli/%5D(https://archlinux.org/packages/extra/x86_64/mkvtoolnix-cli/)">mkvtoolnix-cli</a> packages.</p>
<p>Example with libx265 (software/CPU transcode):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">other-transcode</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">--target</span> <span class="m">12000</span> <span class="se">\ </span> <span class="c"># there are defaults for each resolution, but imo they&#39;re too low
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--x265</span> <span class="se">\ </span> <span class="c"># change this to VAAPI for gpu hw transcode
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--hevc</span> <span class="se">\ </span> <span class="c"># no point in not doing HEVC 
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--mp4</span> <span class="se">\ </span>  <span class="c"># imo it&#39;s widely enough compatible.
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="nf">great</span> for appleTV
</span></span><span class="line"><span class="cl">  <span class="na">--add-audio</span> all <span class="se">\ </span> <span class="c"># without this, the default will strip out all the extraneous audio
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--add-subtitle</span> eng <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="o">&lt;</span>/path/to/file.mkv<span class="o">&gt;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-n</span> <span class="c"># &#34;dry run&#34; (just prints the ffmpeg commmand)mi
</span></span></span></code></pre></div><p>Example with iGPU (hardware accelerated transcode):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">other-transcode</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">--vaapi</span> <span class="se">\ </span> <span class="c"># this is a reliable api for linux + intel w/ iGPU (QuickSync)
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--target</span> <span class="m">12000</span> <span class="se">\ </span> <span class="c"># VAAPI doesn&#39;t have an easy equivalent of CRF ; this should be tweaked per title
</span></span></span><span class="line"><span class="cl"><span class="c"></span>  <span class="na">--hevc</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">--add-audio</span> all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">--add-subtitle</span> eng <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="o">&lt;</span>/path/to/file.mkv<span class="o">&gt;</span>  <span class="c"># note: omitted --mp4 here because of subtitle incompatability
</span></span></span></code></pre></div><p>[Feb 19, 2022] - there is currently a bug in <code>intel-media-driver</code> that results in corrputed video output when using VAAPI (intel iGPU hw accelerated transcode).</p>
<p>[Feb 20, 2022] - went down the rabbit hole of manually building libva, intel-media-driver (and all intermediate dependencies, yikes!) and ffmpeg with <a href="https://github.com/intel-media-ci/cartwheel-ffmpeg/blob/master/patches/0025-lavc-vaapi_encode_h265-fix-max_transform_hierarchy_d.patch">this patch</a>.</p>
<p>example <code>ffmpeg</code> command that is generated:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">ffmpeg</span> <span class="na">-loglevel</span> error <span class="na">-stats</span> <span class="na">-vaapi_device</span> /dev/dri/renderD128 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-i</span> /media/movies/Honeyland<span class="se">\ \(</span><span class="nf">2019</span><span class="se">\)</span>/Honeyland<span class="se">\ \(</span><span class="nf">2019</span><span class="se">\)\ </span>Remux-1080p.mkv <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-map</span> <span class="m">0</span>:<span class="m">0</span> <span class="na">-filter</span>:v yadif,format<span class="se">\=</span>nv12,hwupload <span class="na">-c</span>:v hevc_vaapi <span class="na">-b</span>:v 9000k <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-color_primaries</span>:v bt709 <span class="na">-color_trc</span>:v bt709 <span class="na">-colorspace</span>:v bt709 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-metadata</span>:s:v title<span class="se">\=</span> <span class="na">-disposition</span>:v default <span class="na">-map</span> <span class="m">0</span>:<span class="m">1</span> <span class="na">-c</span>:​a:<span class="m">0</span> ac3 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-metadata</span>:s:​a:<span class="m">0</span> title<span class="se">\=</span> <span class="na">-disposition</span>:​a:<span class="m">0</span> default <span class="na">-map</span> <span class="m">0</span>:<span class="m">2</span> <span class="na">-c</span>:​a:<span class="m">1</span> aac <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-metadata</span>:s:​a:<span class="m">1</span> title<span class="se">\=</span> <span class="na">-disposition</span>:​a:<span class="m">1</span> <span class="m">0</span> <span class="na">-sn</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="na">-metadata</span>:g title<span class="se">\=</span> <span class="na">-default_mode</span> passthrough <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="nf">Honeyland</span><span class="se">\ \(</span><span class="nf">2019</span><span class="se">\)\ </span>Remux-1080p.mkv
</span></span></code></pre></div><p>general ffmpeg param structure:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">ffmpeg</span> <span class="na">-i</span> <span class="o">&lt;</span>input file<span class="o">&gt;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>		<span class="na">-stats</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>		<span class="na">-&lt;extra</span> params<span class="o">&gt;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>		<span class="o">&lt;</span>output_file_name<span class="o">&gt;</span>
</span></span></code></pre></div><p>(likely rare), but remux + transcode BR disk .iso rip:</p>
<p><a href="https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html">https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html</a></p>
<p>essentially, the process is 1) mount the iso, find the correct m2ts file, combine them if necessary, then ffmpeg to package it up into .mkv and transcode if desired.
Here’s an example of processing Apollo 11 blu-ray full disk:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">ffmpeg</span> <span class="na">-i</span> br/BDMV/STREAM/<span class="m">00006</span>.m2ts <span class="na">-stats</span> <span class="na">-map</span> <span class="m">0</span>:<span class="m">0</span> <span class="na">-pix_fmt</span> yuv420p10le <span class="na">-c</span>:v libx265 <span class="na">-x265-params</span> <span class="nv">profile</span><span class="o">=</span>main10:<span class="nv">crf</span><span class="o">=</span><span class="m">20</span> <span class="na">-tag</span>:v hvc1 <span class="na">-map</span> <span class="m">0</span>:​a &#39;Apollo <span class="m">11</span> <span class="o">(</span><span class="nf">2019</span><span class="o">)</span> Remux-2160p.mp4’
</span></span></code></pre></div><p>using CRF for 4k main10:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fish" data-lang="fish"><span class="line"><span class="cl"><span class="nf">nohup</span> ffmpeg <span class="na">-loglevel</span> error <span class="na">-stats</span> <span class="na">-i</span> ../Jojo<span class="se">\ </span>Rabbit<span class="se">\ \(</span><span class="nf">2019</span><span class="se">\)\ </span>Remux-2160p.mkv <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-map</span> <span class="m">0</span>:<span class="m">0</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-c</span>:v libx265 <span class="na">-pix_fmt</span>:v yuv420p10le <span class="na">-crf</span> <span class="m">17</span> <span class="na">-preset</span> <span class="nv">slower</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-color_primaries</span>:v bt2020 <span class="na">-color_trc</span>:v smpte2084 <span class="na">-colorspace</span>:v bt2020nc <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-metadata</span>:s:v title<span class="se">\=</span> <span class="na">-disposition</span>:v default <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-map</span> <span class="m">0</span>:<span class="m">1</span> <span class="na">-c</span>:​a:<span class="m">0</span> ac3 <span class="na">-metadata</span>:s:​a:<span class="m">0</span> title<span class="se">\=</span> <span class="na">-disposition</span>:​a:<span class="m">0</span> default <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="na">-sn</span> <span class="na">-metadata</span>:g title<span class="se">\=</span> <span class="na">-default_mode</span> passthrough <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nf">Jojo</span><span class="se">\ </span>Rabbit<span class="se">\ \(</span><span class="nf">2019</span><span class="se">\)\ </span>Remux-2160p.mkv <span class="o">&amp;</span>
</span></span></code></pre></div><div class="!mb-9 text-xl lead">
  Quality checking the transcoded output is essential.
</div>

<h2 id="further-reading" class="relative group">further reading <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#further-reading" aria-label="Anchor">#</a></span></h2>
<p><a href="https://codecalamity.com/encoding-settings-for-hdr-4k-videos-using-10-bit-x265/">https://codecalamity.com/encoding-settings-for-hdr-4k-videos-using-10-bit-x265/</a> - tl;dr CRF 20 preset slow</p>
<blockquote>
<p><a href="https://aaron.cc/ffmpeg-hevc-apple-devices/">Apple TV 4k hevc</a> - Use the <code>-tag:v hvc1</code> parameter in your FFmpeg command make your HEVC file work on Apple devices.</p>
</blockquote>
<p><a href="https://codecalamity.com/stop-re-encoding-videos/">https://codecalamity.com/stop-re-encoding-videos/</a></p>
<p><a href="https://slhck.info/video/2017/02/24/crf-guide.html">https://slhck.info/video/2017/02/24/crf-guide.html</a></p>
<p><a href="https://netflixtechblog.com/per-title-encode-optimization-7e99442b62a2">https://netflixtechblog.com/per-title-encode-optimization-7e99442b62a2</a> - very interesting.
Big takeaways are:</p>
<ol>
<li>every netflix title is considered to have its own optimal bitrate + quality level for each resolution</li>
<li>Lower resolution + higher precision can result in greater quality than higher res + lower precision, but mostly at the low side of the quality curve.</li>
<li>netflix stores multiple encodes per resolution, per title. Storage tradeoff gives bandwidth + user experience wins</li>
</ol>
<p><a href="https://gist.github.com/Brainiarc7/95c9338a737aa36d9bb2931bed379219">Using VAAPI&rsquo;s hardware accelerated video encoding on Linux with Intel&rsquo;s hardware on FFmpeg and libav</a></p>
<h2 id="still-todo--open-questions" class="relative group">still TODO / open questions <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#still-todo--open-questions" aria-label="Anchor">#</a></span></h2>
<ul>
<li>test performance / effect of performing conversion over NFS
<ul>
<li>for the ryzen + Nvidia system, the source file is first copied to the local machine</li>
<li>when a 3rd system is used for transcode directly via NFS, CPU on the NFS server rises to about 25% usage!</li>
</ul>
</li>
<li>audio codecs
<ul>
<li>probably can find a good preset for “basic 5.1”</li>
</ul>
</li>
</ul>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Ken Verb
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">Former techie scumbag</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:www@kverb.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/kverb"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://instagram.com/kverb.com"
          target="_blank"
          aria-label="Instagram"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://keybase.io/kverb"
          target="_blank"
          aria-label="Keybase"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M286.17 419a18 18 0 1 0 18 18 18 18 0 0 0-18-18zm111.92-147.6c-9.5-14.62-39.37-52.45-87.26-73.71q-9.1-4.06-18.38-7.27a78.43 78.43 0 0 0-47.88-104.13c-12.41-4.1-23.33-6-32.41-5.77-.6-2-1.89-11 9.4-35L198.66 32l-5.48 7.56c-8.69 12.06-16.92 23.55-24.34 34.89a51 51 0 0 0-8.29-1.25c-41.53-2.45-39-2.33-41.06-2.33-50.61 0-50.75 52.12-50.75 45.88l-2.36 36.68c-1.61 27 19.75 50.21 47.63 51.85l8.93.54a214 214 0 0 0-46.29 35.54C14 304.66 14 374 14 429.77v33.64l23.32-29.8a148.6 148.6 0 0 0 14.56 37.56c5.78 10.13 14.87 9.45 19.64 7.33 4.21-1.87 10-6.92 3.75-20.11a178.29 178.29 0 0 1-15.76-53.13l46.82-59.83-24.66 74.11c58.23-42.4 157.38-61.76 236.25-38.59 34.2 10.05 67.45.69 84.74-23.84.72-1 1.2-2.16 1.85-3.22a156.09 156.09 0 0 1 2.8 28.43c0 23.3-3.69 52.93-14.88 81.64-2.52 6.46 1.76 14.5 8.6 15.74 7.42 1.57 15.33-3.1 18.37-11.15C429 443 434 414 434 382.32c0-38.58-13-77.46-35.91-110.92zM142.37 128.58l-15.7-.93-1.39 21.79 13.13.78a93 93 0 0 0 .32 19.57l-22.38-1.34a12.28 12.28 0 0 1-11.76-12.79L107 119c1-12.17 13.87-11.27 13.26-11.32l29.11 1.73a144.35 144.35 0 0 0-7 19.17zm148.42 172.18a10.51 10.51 0 0 1-14.35-1.39l-9.68-11.49-34.42 27a8.09 8.09 0 0 1-11.13-1.08l-15.78-18.64a7.38 7.38 0 0 1 1.34-10.34l34.57-27.18-14.14-16.74-17.09 13.45a7.75 7.75 0 0 1-10.59-1s-3.72-4.42-3.8-4.53a7.38 7.38 0 0 1 1.37-10.34L214 225.19s-18.51-22-18.6-22.14a9.56 9.56 0 0 1 1.74-13.42 10.38 10.38 0 0 1 14.3 1.37l81.09 96.32a9.58 9.58 0 0 1-1.74 13.44zM187.44 419a18 18 0 1 0 18 18 18 18 0 0 0-18-18z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/server/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >server notes</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-06-11 12:45:58 -0400 EDT">11 June 2022</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    </footer>
    
  </article>

        
          <div
            class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex justify-between">
    <div>
      
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2022
          Ken Verb
      </p>
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>

    </div>
  </body>
</html>
