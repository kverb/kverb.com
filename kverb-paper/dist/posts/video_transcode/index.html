<!DOCTYPE html><html lang="en" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="canonical" href="https://www.kverb.com/posts/video_transcode/"><meta name="generator" content="Astro v4.13.0"><!-- General Meta Tags --><title>video transcoding notes | kverb.com</title><meta name="title" content="video transcoding notes | kverb.com"><meta name="description" content="Notes on video transcoding (movies + tv shows)"><meta name="author" content="Ken V"><link rel="sitemap" href="/sitemap-index.xml"><!-- Open Graph / Facebook --><meta property="og:title" content="video transcoding notes | kverb.com"><meta property="og:description" content="Notes on video transcoding (movies + tv shows)"><meta property="og:url" content="https://www.kverb.com/posts/video_transcode/"><meta property="og:image" content="https://www.kverb.com/posts/video-transcoding-notes.png"><!-- Article Published/Modified time --><meta property="article:published_time" content="2022-06-11T16:45:58.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.kverb.com/posts/video_transcode/"><meta property="twitter:title" content="video transcoding notes | kverb.com"><meta property="twitter:description" content="Notes on video transcoding (movies + tv shows)"><meta property="twitter:image" content="https://www.kverb.com/posts/video-transcoding-notes.png"><!-- Google JSON-LD Structured data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"video transcoding notes | kverb.com","image":"https://www.kverb.com/posts/video-transcoding-notes.png","datePublished":"2022-06-11T16:45:58.000Z","author":[{"@type":"Person","name":"Ken V","url":"https://keybase.io/kverb/"}]}</script><!-- Google Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet"><meta name="theme-color" content=""><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script src="/toggle-theme.js"></script><style>.breadcrumb:where(.astro-ilhxcym7){margin-left:auto;margin-right:auto;margin-bottom:.25rem;margin-top:2rem;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7){display:inline}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7) a:where(.astro-ilhxcym7){text-transform:capitalize;opacity:.7}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7) span:where(.astro-ilhxcym7){opacity:.7}.breadcrumb:where(.astro-ilhxcym7) ul:where(.astro-ilhxcym7) li:where(.astro-ilhxcym7):not(:last-child) a:where(.astro-ilhxcym7):hover{opacity:1}
</style>
<link rel="stylesheet" href="/_astro/about.DXHdLjVL.css">
<style>#main-content:where(.astro-hsp6otuf){margin-left:auto;margin-right:auto;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem;padding-bottom:1rem}#main-content:where(.astro-hsp6otuf) h1:where(.astro-hsp6otuf){font-size:1.5rem;line-height:2rem;font-weight:600}@media (min-width: 640px){#main-content:where(.astro-hsp6otuf) h1:where(.astro-hsp6otuf){font-size:1.875rem;line-height:2.25rem}}#main-content:where(.astro-hsp6otuf) p:where(.astro-hsp6otuf){margin-bottom:1.5rem;margin-top:.5rem;font-style:italic}
a:where(.astro-blwjyjpt){position:relative;text-decoration-line:underline;text-decoration-style:dashed}a:where(.astro-blwjyjpt):hover{top:-.125rem;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}a:where(.astro-blwjyjpt):focus-visible{padding:.25rem}a:where(.astro-blwjyjpt) svg:where(.astro-blwjyjpt){margin-right:-1.25rem;height:1.5rem;width:1.5rem;--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity));opacity:.8}.group:where(.astro-blwjyjpt):hover a:where(.astro-blwjyjpt) svg:where(.astro-blwjyjpt){fill:rgb(var(--color-accent))}
@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
.pagination-wrapper:where(.astro-d776pwuy){margin-bottom:2rem;margin-top:auto;display:flex;justify-content:center}.disabled:where(.astro-d776pwuy){pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.5}.disabled:where(.astro-d776pwuy):hover{--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.group:where(.astro-d776pwuy):hover .disabled:where(.astro-d776pwuy){fill:rgb(var(--color-text-base))}.group:where(.astro-d776pwuy):hover .disabled-svg:where(.astro-d776pwuy){fill:rgb(var(--color-text-base))!important}
.social-icons:where(.astro-wkojbtzc){display:flex;flex-direction:column;flex-wrap:wrap;align-items:center;justify-content:center;gap:.25rem}@media (min-width: 640px){.social-icons:where(.astro-wkojbtzc){align-items:flex-start}}.link-button:where(.astro-wkojbtzc){--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));padding:.5rem}.link-button:where(.astro-wkojbtzc):hover{--tw-rotate: 6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@media (min-width: 640px){.link-button:where(.astro-wkojbtzc){padding:.25rem}}main:where(.astro-vj4tpspi){margin-left:auto;margin-right:auto;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem;padding-bottom:3rem}.post-title:where(.astro-vj4tpspi){font-size:1.5rem;line-height:2rem;font-weight:600;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}
</style><script type="module" src="/_astro/hoisted.lSUI3qGY.js"></script><style>[data-astro-transition-scope="astro-plk3gbjq-1"] { view-transition-name: video-transcoding-notes; }@layer astro { ::view-transition-old(video-transcoding-notes) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(video-transcoding-notes) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(video-transcoding-notes) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(video-transcoding-notes) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-plk3gbjq-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-plk3gbjq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-plk3gbjq-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-plk3gbjq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-plk3gbjq-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-plk3gbjq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-plk3gbjq-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-plk3gbjq-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style><style>[data-astro-transition-scope="astro-36ssibgs-2"] { view-transition-name: others; }@layer astro { ::view-transition-old(others) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(others) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(others) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(others) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-36ssibgs-2"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-36ssibgs-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-36ssibgs-2"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-36ssibgs-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-36ssibgs-2"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-36ssibgs-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-36ssibgs-2"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-36ssibgs-2"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body>  <header class="astro-3ef6ksr2"> <a id="skip-to-content" href="#main-content" class="astro-3ef6ksr2">Skip to content</a> <div class="nav-container astro-3ef6ksr2"> <div class="top-nav-wrap astro-3ef6ksr2"> <a href="/" class="logo whitespace-nowrap astro-3ef6ksr2"> kverb.com </a> <nav id="nav-menu" class="astro-3ef6ksr2"> <button class="hamburger-menu focus-outline astro-3ef6ksr2" aria-label="Open Menu" aria-expanded="false" aria-controls="menu-items"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="menu-icon astro-3ef6ksr2"> <line x1="7" y1="12" x2="21" y2="12" class="line astro-3ef6ksr2"></line> <line x1="3" y1="6" x2="21" y2="6" class="line astro-3ef6ksr2"></line> <line x1="12" y1="18" x2="21" y2="18" class="line astro-3ef6ksr2"></line> <line x1="18" y1="6" x2="6" y2="18" class="close astro-3ef6ksr2"></line> <line x1="6" y1="6" x2="18" y2="18" class="close astro-3ef6ksr2"></line> </svg> </button> <ul id="menu-items" class="display-none sm:flex astro-3ef6ksr2"> <li class="astro-3ef6ksr2"> <a href="/posts/" class=" astro-3ef6ksr2">
Posts
</a> </li> <li class="astro-3ef6ksr2"> <a href="/tags/" class=" astro-3ef6ksr2">
Tags
</a> </li> <li class="astro-3ef6ksr2"> <a href="/about/" class=" astro-3ef6ksr2">
About
</a> </li> <li class="astro-3ef6ksr2"> <a href="/search/" class="group inline-block hover:text-skin-accent focus-outline p-3 sm:p-1  flex astro-3ef6ksr2" aria-label="search" title="Search"> <svg xmlns="http://www.w3.org/2000/svg" class="scale-125 sm:scale-100 astro-3ef6ksr2"><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" class="astro-3ef6ksr2"></path> </svg> <span class="sr-only astro-3ef6ksr2">Search</span> </a> </li> <li class="astro-3ef6ksr2"> <button id="theme-btn" class="focus-outline astro-3ef6ksr2" title="Toggles light & dark" aria-label="auto" aria-live="polite"> <svg xmlns="http://www.w3.org/2000/svg" id="moon-svg" class="astro-3ef6ksr2"> <path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z" class="astro-3ef6ksr2"></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" id="sun-svg" class="astro-3ef6ksr2"> <path d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z" class="astro-3ef6ksr2"></path> </svg> </button> </li> </ul> </nav> </div> </div> <div class="max-w-3xl mx-auto px-4"> <hr class="border-skin-line" aria-hidden="true"> </div> </header>   <div class="mx-auto flex w-full max-w-3xl justify-start px-2 astro-vj4tpspi"> <button class="focus-outline mb-2 mt-8 flex hover:opacity-75 astro-vj4tpspi" onclick="(() => (history.length === 1) ? window.location = '/' : history.back())()"> <svg xmlns="http://www.w3.org/2000/svg" class="astro-vj4tpspi"><path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" class="astro-vj4tpspi"></path> </svg><span class="astro-vj4tpspi">Go back</span> </button> </div> <main id="main-content" class="astro-vj4tpspi"> <h1 class="post-title astro-vj4tpspi" data-astro-transition-scope="astro-plk3gbjq-1">video transcoding notes</h1> <div class="flex items-center space-x-2 opacity-80 my-2 astro-vj4tpspi"><svg xmlns="http://www.w3.org/2000/svg" class="scale-100 inline-block h-6 w-6 min-w-[1.375rem] fill-skin-base" aria-hidden="true"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg><span class="sr-only">Published:</span><span class="italic text-base"><time dateTime="2022-06-11T16:45:58.000Z">Jun 11, 2022</time><span aria-hidden="true"> | </span><span class="sr-only"> at </span><span class="text-nowrap">04:45 PM</span></span></div> <article id="article" class="prose mx-auto mt-8 max-w-3xl astro-vj4tpspi"> <h2 id="meta">meta</h2>
<p>These are some notes gathered on my exploration of transcoding videos for more reliable playback.
This doesn’t cover the downloading of the video files; just post-processing them into different formats for playback, primarily on an Apple TV 4k (2019).</p>
<p>Hardware used:</p>
<ul>
<li>AMD Ryzen 7 3800X 8-Core Processor + NVIDIA GeForce RTX 2060 SUPER</li>
<li>11th Gen Intel(R) Core(TM) i5-11400 @ 2.60GHz + (iGPU)</li>
</ul>
<h2 id="overview">overview</h2>
<p>The main take-aways are:</p>
<ul>
<li>Most titles downloaded from the internet are h264 encoded, mkv container files.</li>
<li>Audio codecs vary and subtitles are complete anarchy.</li>
<li>AppleTV (my primary playback client) can play the h264 encoded stream generally without issue.
<ul>
<li>It requires on-the-fly remux from MKV to MP4 and (usually) audio transcoding, but generally uses very little cpu on the plex server.</li>
</ul>
</li>
<li>HEVC / h265 <em>can</em> be more space efficient for the same quality, so converting the library to it is worthwhile.
<ul>
<li>However, there are observable limits to how much space can be saved for a given quality level.</li>
<li>The main heuristic is thus:
<ul>
<li>if the source file is a high-bitrate, h264 or original iso, then convert to HEVC at about 10mbps (for 1080p).</li>
<li>In general, the quality trade off (as well as the energy required to process the transcode) just doesn’t make sense if the file is already below an avg bitrate of 15 mbps.</li>
<li>Also, a “how much do i like this movie” factor should be considered for if and how much quality loss is acceptable.</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://codecalamity.com/hardware-encoding-4k-hdr10-videos/#has-hevc-hardware-encoding-caught-up-to-the-quality-of-software-encoding">Prefer libx265 (cpu / software) based transcodes to GPU-assisted transcodes.</a> GPU is ideal for real-time transcoding.</li>
<li>Although it will take much longer, x265 will yield higher quality at smaller space.</li>
<li>Consider GPU transcodes for “less important” titles; i.e., movies and series that don’t need “archival quality”.</li>
<li>Subtitles are … annoying if converting from mkv to mp4.
<ul>
<li>The <a href="https://github.com/donmelton/other_video_transcoding">“other transcoding”</a> script seems to handle this, but because mp4 lacks support for lots of subtitle formats, there are still limitations.</li>
</ul>
</li>
</ul>
<h2 id="donmeltons-other_video_transcode-tool">Donmelton’s other_video_transcode tool</h2>
<p>Use this script to generate an ffmpeg command that can be executed on another system, if needed.</p>
<p><a href="https://github.com/donmelton/other_video_transcoding">https://github.com/donmelton/other_video_transcoding</a></p>
<p>This is basically an easier-to-understand wrapper for ffmpeg.
Install ruby, then install this with ruby gems.
It’s helpful to read the script to get a better understanding of all the options and how they map to ffmpeg params.</p>
<p>It requires <strong>ffmpeg</strong> and the <a href="%5Bhttps://archlinux.org/packages/extra/x86_64/mkvtoolnix-cli/%5D(https://archlinux.org/packages/extra/x86_64/mkvtoolnix-cli/)">mkvtoolnix-cli</a> packages.</p>
<p>Example with libx265 (software/CPU transcode):</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">other-transcode</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --target</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> 12000 </span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> there are defaults for each resolution, but imo they're too low</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --x265</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> \ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> change this to VAAPI for gpu hw transcode</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --hevc</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> \ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> no point in not doing HEVC </span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --mp4</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> \ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic">  #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> imo it's widely enough compatible.</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  great</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> for</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> appleTV</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --add-audio</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> all </span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> without this, the default will strip out all the extraneous audio</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --add-subtitle</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> eng \</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">  &#x3C;</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">/path/to/file.mkv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">></span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -n</span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> "dry run" (just prints the ffmpeg commmand)mi</span></span>
<span class="line"></span></code></pre>
<p>Example with iGPU (hardware accelerated transcode):</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">other-transcode</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --vaapi</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0"> \ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> this is a reliable api for linux + intel w/ iGPU (QuickSync)</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --target</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> 12000 </span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ </span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic"> #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> VAAPI doesn't have an easy equivalent of CRF ; this should be tweaked per title</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --hevc</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --add-audio</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> all \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  --add-subtitle</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> eng \</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">  &#x3C;</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">/path/to/file.mkv</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">></span><span style="color:#908CAA;--shiki-dark:#908CAA;font-style:italic;--shiki-dark-font-style:italic">  #</span><span style="color:#6E6A86;--shiki-dark:#6E6A86;font-style:italic;--shiki-dark-font-style:italic"> note: omitted --mp4 here because of subtitle incompatability</span></span>
<span class="line"></span></code></pre>
<p>[Feb 19, 2022] - there is currently a bug in <code>intel-media-driver</code> that results in corrputed video output when using VAAPI (intel iGPU hw accelerated transcode).</p>
<p>[Feb 20, 2022] - went down the rabbit hole of manually building libva, intel-media-driver (and all intermediate dependencies, yikes!) and ffmpeg with <a href="https://github.com/intel-media-ci/cartwheel-ffmpeg/blob/master/patches/0025-lavc-vaapi_encode_h265-fix-max_transform_hierarchy_d.patch">this patch</a>.</p>
<p>example <code>ffmpeg</code> command that is generated:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">ffmpeg</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> -loglevel error -stats -vaapi_device /dev/dri/renderD128 \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -i</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> /media/movies/Honeyland</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ \(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">2019</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\)</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">/Honeyland</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ \(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">2019</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\)\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Remux-1080p.mkv \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -map</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> 0:0 -filter:v yadif,format\=nv12,hwupload -c:v hevc_vaapi -b:v 9000k \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -color_primaries</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:v bt709 -color_trc:v bt709 -colorspace:v bt709 \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -metadata</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:s:v title\= -disposition:v default -map 0:1 -c:​a:0 ac3 \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -metadata</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:s:​a:0 title\= -disposition:​a:0 default -map 0:2 -c:​a:1 aac \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -metadata</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:s:​a:1 title\= -disposition:​a:1 0 -sn \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -metadata</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:g title\= -default_mode passthrough \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  Honeyland</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ \(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">2019</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\)\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Remux-1080p.mkv</span></span>
<span class="line"></span></code></pre>
<p>general ffmpeg param structure:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">ffmpeg</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> -i </span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x3C;</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">input file</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">></span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">	-stats</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">	-</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x3C;</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">extra params</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">></span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> \</span></span>
<span class="line"><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">	&#x3C;</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">output_file_name</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">></span></span>
<span class="line"></span></code></pre>
<p>(likely rare), but remux + transcode BR disk .iso rip:</p>
<p><a href="https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html">https://unixsheikh.com/tutorials/remuxing-iso-dvd-or-bluray-using-cat-and-ffmpeg-on-linux.html</a></p>
<p>essentially, the process is 1) mount the iso, find the correct m2ts file, combine them if necessary, then ffmpeg to package it up into .mkv and transcode if desired.
Here’s an example of processing Apollo 11 blu-ray full disk:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  ffmpeg</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> -i br/BDMV/STREAM/00006.m2ts -stats -map 0:0 -pix_fmt yuv420p10le -c:v libx265 -x265-params profile=main10:crf=20 -tag:v hvc1 -map 0:​a </span><span style="color:#F6C177;--shiki-dark:#F6C177">'Apollo 11 (2019) Remux-2160p.mp4’</span></span>
<span class="line"></span></code></pre>
<p>using CRF for 4k main10:</p>
<pre class="astro-code astro-code-themes rose-pine-moon rose-pine-moon" style="background-color:#232136;--shiki-dark-bg:#232136;color:#e0def4;--shiki-dark:#e0def4; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="fish"><code><span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">nohup</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> ffmpeg -loglevel error -stats -i ../Jojo</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Rabbit</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ \(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">2019</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\)\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Remux-2160p.mkv \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -map</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> 0:0 \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -c</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:v libx265 -pix_fmt:v yuv420p10le -crf 17 -preset slower \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -color_primaries</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:v bt2020 -color_trc:v smpte2084 -colorspace:v bt2020nc \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -metadata</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">:s:v title\= -disposition:v default \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -map</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> 0:1 -c:​a:0 ac3 -metadata:s:​a:0 title\= -disposition:​a:0 default \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  -sn</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4"> -metadata:g title\= -default_mode passthrough \</span></span>
<span class="line"><span style="color:#EB6F92;--shiki-dark:#EB6F92;font-style:italic;--shiki-dark-font-style:italic">  Jojo</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Rabbit</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\ \(</span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">2019</span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">\)\ </span><span style="color:#E0DEF4;--shiki-dark:#E0DEF4">Remux-2160p.mkv </span><span style="color:#3E8FB0;--shiki-dark:#3E8FB0">&#x26;</span></span>
<span class="line"></span></code></pre>
<p>{{&#x3C; lead >}}
Quality checking the transcoded output is essential.
{{&#x3C; /lead  >}}</p>
<h2 id="further-reading">further reading</h2>
<p><a href="https://codecalamity.com/encoding-settings-for-hdr-4k-videos-using-10-bit-x265/">https://codecalamity.com/encoding-settings-for-hdr-4k-videos-using-10-bit-x265/</a> - tl;dr CRF 20 preset slow</p>
<blockquote>
<p><a href="https://aaron.cc/ffmpeg-hevc-apple-devices/">Apple TV 4k hevc</a> - Use the <code>-tag:v hvc1</code> parameter in your FFmpeg command make your HEVC file work on Apple devices.</p>
</blockquote>
<p><a href="https://codecalamity.com/stop-re-encoding-videos/">https://codecalamity.com/stop-re-encoding-videos/</a></p>
<p><a href="https://slhck.info/video/2017/02/24/crf-guide.html">https://slhck.info/video/2017/02/24/crf-guide.html</a></p>
<p><a href="https://netflixtechblog.com/per-title-encode-optimization-7e99442b62a2">https://netflixtechblog.com/per-title-encode-optimization-7e99442b62a2</a> - very interesting.
Big takeaways are:</p>
<ol>
<li>every netflix title is considered to have its own optimal bitrate + quality level for each resolution</li>
<li>Lower resolution + higher precision can result in greater quality than higher res + lower precision, but mostly at the low side of the quality curve.</li>
<li>netflix stores multiple encodes per resolution, per title. Storage tradeoff gives bandwidth + user experience wins</li>
</ol>
<p><a href="https://gist.github.com/Brainiarc7/95c9338a737aa36d9bb2931bed379219">Using VAAPI’s hardware accelerated video encoding on Linux with Intel’s hardware on FFmpeg and libav</a></p>
<h2 id="still-todo--open-questions">still TODO / open questions</h2>
<ul>
<li>test performance / effect of performing conversion over NFS
<ul>
<li>for the ryzen + Nvidia system, the source file is first copied to the local machine</li>
<li>when a 3rd system is used for transcode directly via NFS, CPU on the NFS server rises to about 25% usage!</li>
</ul>
</li>
<li>audio codecs
<ul>
<li>probably can find a good preset for “basic 5.1”</li>
</ul>
</li>
</ul> </article> <ul class="my-8 astro-vj4tpspi"> <li class="inline-block my-1 underline-offset-4 astro-blwjyjpt"> <a href="/tags/others/" class="text-sm pr-2 group astro-blwjyjpt" data-astro-transition-scope="astro-36ssibgs-2"> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75 astro-blwjyjpt"><path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" class="astro-blwjyjpt"></path> </svg>
&nbsp;<span class="astro-blwjyjpt">others</span> </a> </li>  </ul> <div class="flex flex-col-reverse items-center justify-between gap-6 sm:flex-row-reverse sm:items-end sm:gap-4 astro-vj4tpspi"> <button id="back-to-top" class="focus-outline whitespace-nowrap py-1 hover:opacity-75 astro-vj4tpspi"> <svg xmlns="http://www.w3.org/2000/svg" class="rotate-90 astro-vj4tpspi"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z" class="astro-vj4tpspi"></path> </svg> <span class="astro-vj4tpspi">Back to Top</span> </button> <div class="social-icons astro-wkojbtzc"> <span class="italic astro-wkojbtzc">Share this post on:</span> <div class="text-center astro-wkojbtzc"> <a href="https://wa.me/?text=https://www.kverb.com/posts/video_transcode/" class="group inline-block hover:text-skin-accent link-button astro-wkojbtzc" title="Share this post via WhatsApp"> <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9"></path>
      <path d="M9 10a0.5 .5 0 0 0 1 0v-1a0.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a0.5 .5 0 0 0 0 -1h-1a0.5 .5 0 0 0 0 1"></path>
    </svg> <span class="sr-only astro-wkojbtzc">Share this post via WhatsApp</span> </a><a href="mailto:?subject=See%20this%20post&#38;body=https://www.kverb.com/posts/video_transcode/" class="group inline-block hover:text-skin-accent link-button astro-wkojbtzc" title="Share this post via email"> <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
      <polyline points="3 7 12 13 21 7"></polyline>
    </svg> <span class="sr-only astro-wkojbtzc">Share this post via email</span> </a> </div> </div>  </div> </main> <footer class="mt-auto astro-sz7xmlte"> <div class="max-w-3xl mx-auto px-0"> <hr class="border-skin-line" aria-hidden="true"> </div> <div class="footer-wrapper astro-sz7xmlte"> <div class="social-icons flex astro-upu6fzxr"> <a href="https://github.com/kverb/kverb.com" class="group inline-block hover:text-skin-accent link-button astro-upu6fzxr" title=" kverb.com on Github"> <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path
      d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
    ></path>
  </svg> <span class="sr-only astro-upu6fzxr"> kverb.com on Github</span> </a><a href="https://instagram.com/kverb" class="group inline-block hover:text-skin-accent link-button astro-upu6fzxr" title="kverb.com on Instagram"> <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="4"></rect>
    <circle cx="12" cy="12" r="3"></circle>
    <line x1="16.5" y1="7.5" x2="16.5" y2="7.501"></line>
  </svg> <span class="sr-only astro-upu6fzxr">kverb.com on Instagram</span> </a><a href="mailto:ken@kverb.com" class="group inline-block hover:text-skin-accent link-button astro-upu6fzxr" title="Send an email to kverb.com"> <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
      <polyline points="3 7 12 13 21 7"></polyline>
    </svg> <span class="sr-only astro-upu6fzxr">Send an email to kverb.com</span> </a> </div>  <div class="copyright-wrapper astro-sz7xmlte"> <span class="astro-sz7xmlte">Copyright &#169; lmao</span> <span class="separator astro-sz7xmlte">&nbsp;|&nbsp;</span> <span class="astro-sz7xmlte">All rights reserved.</span> </div> </div> </footer>   </body></html>  <script>
  /** Create a progress indicator
   *  at the top */
  function createProgressBar() {
    // Create the main container div
    const progressContainer = document.createElement("div");
    progressContainer.className =
      "progress-container fixed top-0 z-10 h-1 w-full bg-skin-fill";

    // Create the progress bar div
    const progressBar = document.createElement("div");
    progressBar.className = "progress-bar h-1 w-0 bg-skin-accent";
    progressBar.id = "myBar";

    // Append the progress bar to the progress container
    progressContainer.appendChild(progressBar);

    // Append the progress container to the document body or any other desired parent element
    document.body.appendChild(progressContainer);
  }
  createProgressBar();

  /** Update the progress bar
   *  when user scrolls */
  function updateScrollProgress() {
    const winScroll =
      document.body.scrollTop || document.documentElement.scrollTop;
    const height =
      document.documentElement.scrollHeight -
      document.documentElement.clientHeight;
    const scrolled = (winScroll / height) * 100;
    if (document) {
      const myBar = document.getElementById("myBar");
      if (myBar) {
        myBar.style.width = scrolled + "%";
      }
    }
  }
  document.addEventListener("scroll", updateScrollProgress);

  /** Attaches links to headings in the document,
   *  allowing sharing of sections easily */
  function addHeadingLinks() {
    let headings = Array.from(document.querySelectorAll("h2, h3, h4, h5, h6"));
    for (let heading of headings) {
      heading.classList.add("group");
      const link = document.createElement("a");
      link.className =
        "heading-link ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100";
      link.href = "#" + heading.id;

      const span = document.createElement("span");
      span.ariaHidden = "true";
      span.innerText = "#";
      link.appendChild(span);
      heading.appendChild(link);
    }
  }
  addHeadingLinks();

  /** Attaches copy buttons to code blocks in the document,
   * allowing users to copy code easily. */
  function attachCopyButtons() {
    let copyButtonLabel = "Copy";
    let codeBlocks = Array.from(document.querySelectorAll("pre"));

    for (let codeBlock of codeBlocks) {
      let wrapper = document.createElement("div");
      wrapper.style.position = "relative";

      let copyButton = document.createElement("button");
      copyButton.className =
        "copy-code absolute right-3 -top-3 rounded bg-skin-card px-2 py-1 text-xs leading-4 text-skin-base font-medium";
      copyButton.innerHTML = copyButtonLabel;
      codeBlock.setAttribute("tabindex", "0");
      codeBlock.appendChild(copyButton);

      // wrap codebock with relative parent element
      codeBlock?.parentNode?.insertBefore(wrapper, codeBlock);
      wrapper.appendChild(codeBlock);

      copyButton.addEventListener("click", async () => {
        await copyCode(codeBlock, copyButton);
      });
    }

    async function copyCode(block, button) {
      let code = block.querySelector("code");
      let text = code?.innerText;

      await navigator.clipboard.writeText(text ?? "");

      // visual feedback that task is completed
      button.innerText = "Copied";

      setTimeout(() => {
        button.innerText = copyButtonLabel;
      }, 700);
    }
  }
  attachCopyButtons();

  /** Scrolls the document to the top when
   * the "Back to Top" button is clicked. */
  function backToTop() {
    document.querySelector("#back-to-top")?.addEventListener("click", () => {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    });
  }
  backToTop();
</script>